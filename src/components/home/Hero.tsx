import { Link, useNavigate } from "react-router-dom";
import { Button } from "@/components/ui/button";
import { useEffect, useState } from "react";
import { Search, SlidersHorizontal, X } from "lucide-react";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Badge } from "@/components/ui/badge";

const Hero = () => {
  const [currentField, setCurrentField] = useState(0);
  const [displayText, setDisplayText] = useState("");
  const [isDeleting, setIsDeleting] = useState(false);
  const [searchQuery, setSearchQuery] = useState("");
  const [showSearchDropdown, setShowSearchDropdown] = useState(false);
  const [showFilters, setShowFilters] = useState(false);
  const [selectedCategory, setSelectedCategory] = useState<string>("all");
  const [priceRange, setPriceRange] = useState<string>("all");
  const [experienceLevel, setExperienceLevel] = useState<string>("all");
  const navigate = useNavigate();

  const fields = [
    "Career Growth",
    "Mental Health",
    "Academic Success",
    "Interview Prep",
    "Skill Development",
    "Life Choices",
  ];

  const searchSuggestions = [
    "Career Mentorship",
    "Interview Preparation",
    "Mental Health Support",
    "Academic Guidance",
    "Skill Development",
    "Life Coaching",
  ];

  // Diverse mentor cards with various categories and Indian representation
  const mentorCards = [
    {
      id: "1",
      name: "Raj Malhotra",
      title: "Career Coach",
      company: "CareerPath Inc",
      image:
        "https://images.unsplash.com/photo-1566492031773-4f4e44671857?w=200&h=200&fit=crop&crop=faces",
    },
    {
      id: "2",
      name: "Priya Sharma",
      title: "Mental Health Counselor",
      company: "MindWell",
      image:
        "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=200&h=200&fit=crop&crop=faces",
    },
    {
      id: "3",
      name: "Aditya Gupta",
      title: "Data Science Mentor",
      company: "Tech Academy",
      image:
        "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200&h=200&fit=crop&crop=faces",
    },
    {
      id: "4",
      name: "Neha Reddy",
      title: "Interview Specialist",
      company: "PrepMaster",
      image:
        "https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=200&h=200&fit=crop&crop=faces",
    },
    {
      id: "5",
      name: "Arjun Singh",
      title: "Leadership Coach",
      company: "SkillHub",
      image:
        "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=200&h=200&fit=crop&crop=faces",
    },
    {
      id: "6",
      name: "Kavya Iyer",
      title: "Life & Wellness Coach",
      company: "LifePath",
      image:
        "https://images.unsplash.com/photo-1580489944761-15a19d654956?w=200&h=200&fit=crop&crop=faces",
    },
    {
      id: "7",
      name: "Vikram Mehta",
      title: "Product Manager",
      company: "TechCorp",
      image:
        "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=200&h=200&fit=crop&crop=faces",
    },
    {
      id: "8",
      name: "Anjali Desai",
      title: "UX Design Mentor",
      company: "DesignLab",
      image:
        "https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=200&h=200&fit=crop&crop=faces",
    },
    {
      id: "9",
      name: "Rohan Kapoor",
      title: "Business Strategy",
      company: "StartupHub",
      image:
        "https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?w=200&h=200&fit=crop&crop=faces",
    },
    {
      id: "10",
      name: "Divya Nair",
      title: "Content Marketing",
      company: "GrowthCo",
      image:
        "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&h=200&fit=crop&crop=faces",
    },
    {
      id: "11",
      name: "Karan Patel",
      title: "Software Engineer",
      company: "Google",
      image:
        "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=200&h=200&fit=crop&crop=faces",
    },
    {
      id: "12",
      name: "Sneha Joshi",
      title: "HR & Recruitment",
      company: "TalentFirst",
      image:
        "https://images.unsplash.com/photo-1487412720507-e7ab37603c6f?w=200&h=200&fit=crop&crop=faces",
    },
    {
      id: "13",
      name: "Siddharth Rao",
      title: "Finance Advisor",
      company: "WealthPro",
      image:
        "https://images.unsplash.com/photo-1463453091185-61582044d556?w=200&h=200&fit=crop&crop=faces",
    },
    {
      id: "14",
      name: "Meera Krishnan",
      title: "Education Consultant",
      company: "EduExcel",
      image:
        "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=200&h=200&fit=crop&crop=faces",
    },
    {
      id: "15",
      name: "Aman Verma",
      title: "DevOps Engineer",
      company: "CloudTech",
      image:
        "https://images.unsplash.com/photo-1492562080023-ab3db95bfbce?w=200&h=200&fit=crop&crop=faces",
    },
  ];

  const expertProfiles = [
    {
      id: "1",
      image:
        "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=150&h=150&fit=crop&crop=faces",
      name: "Priya Sharma",
    },
    {
      id: "2",
      image:
        "https://images.unsplash.com/photo-1566492031773-4f4e44671857?w=150&h=150&fit=crop&crop=faces",
      name: "Rahul Kumar",
    },
    {
      id: "3",
      image:
        "https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=150&h=150&fit=crop&crop=faces",
      name: "Ananya Singh",
    },
    {
      id: "4",
      image:
        "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop&crop=faces",
      name: "Arjun Patel",
    },
  ];

  useEffect(() => {
    const typingSpeed = 100;
    const deletingSpeed = 50;
    const delayBetweenWords = 2000;
    const currentWord = fields[currentField];

    if (!isDeleting && displayText === currentWord) {
      setTimeout(() => setIsDeleting(true), delayBetweenWords);
      return;
    }

    if (isDeleting && displayText === "") {
      setIsDeleting(false);
      setCurrentField((prev) => (prev + 1) % fields.length);
      return;
    }

    const timeout = setTimeout(
      () => {
        if (isDeleting) {
          setDisplayText(currentWord.substring(0, displayText.length - 1));
        } else {
          setDisplayText(currentWord.substring(0, displayText.length + 1));
        }
      },
      isDeleting ? deletingSpeed : typingSpeed
    );

    return () => clearTimeout(timeout);
  }, [displayText, isDeleting, currentField]);

  useEffect(() => {
    const heroElement = document.getElementById("hero-section");
    if (heroElement) {
      heroElement.classList.add("animate-fade-in-up", "opacity-100");
    }
  }, []);

  const popularOptions = ["Career Growth", "Mental Health", "Interview Prep"];

  const hasActiveFilters =
    selectedCategory !== "all" ||
    priceRange !== "all" ||
    experienceLevel !== "all";

  const handleSearch = (e: React.FormEvent) => {
    e.preventDefault();

    const params = new URLSearchParams();
    if (searchQuery) params.set("q", searchQuery);
    if (selectedCategory !== "all") params.set("category", selectedCategory);
    if (priceRange !== "all") params.set("price", priceRange);
    if (experienceLevel !== "all") params.set("experience", experienceLevel);

    navigate(`/explore?${params.toString()}`);
  };

  const handleClearFilters = () => {
    setSelectedCategory("all");
    setPriceRange("all");
    setExperienceLevel("all");
  };

  const handlePopularClick = (option: string) => {
    navigate(`/explore?q=${encodeURIComponent(option)}`);
  };

  return (
    <section
      id="hero-section"
      className="py-20 md:py-32 opacity-0 transition-opacity duration-700"
    >
      <div className="max-w-7xl mx-auto px-4 md:px-8 xl:px-12">
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
          <div className="text-center lg:text-left lg:pl-0 -mt-32">
            <div className="mb-4">
              <h1 className="text-[2rem] md:text-[2.75rem] font-poppins text-gray-900 mb-2 leading-tight">
                <span className="font-light">Turn </span>
                <span className="font-bold">Questions</span>
                <span className="font-light"> Into </span>
                <span className="font-bold">Conversations</span>
              </h1>
              <p className="text-lg text-gray-600 font-poppins font-light flex items-center justify-center lg:justify-start gap-2 mb-10">
                <span>Get 1-on-1 advice on</span>
                <span className="inline-block min-w-[180px] text-left">
                  <span className="text-matepeak-primary font-semibold">
                    {displayText}
                  </span>
                  <span className="animate-pulse text-matepeak-primary">|</span>
                </span>
              </p>
            </div>

            {/* Search Bar with Filters */}
            <div className="flex flex-col justify-center lg:justify-start mb-8 mt-10">
              <form
                onSubmit={handleSearch}
                className="relative w-full max-w-2xl mb-4"
              >
                {/* Main Search Input */}
                <div className="relative">
                  <input
                    type="text"
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    onFocus={() => setShowSearchDropdown(true)}
                    onBlur={() =>
                      setTimeout(() => setShowSearchDropdown(false), 200)
                    }
                    placeholder="What type of mentor are you interested in?"
                    className="w-full h-14 pl-6 pr-32 rounded-full bg-gray-50 hover:bg-white focus:bg-white border border-gray-200 text-gray-700 placeholder:text-sm placeholder:text-gray-500 outline-none hover:border-gray-300 focus:border-matepeak-primary focus:ring-2 focus:ring-matepeak-primary/20 transition-all"
                  />

                  {/* Right side buttons */}
                  <div className="absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-2">
                    {/* Filter Toggle Button */}
                    <button
                      type="button"
                      onClick={() => setShowFilters(!showFilters)}
                      className={`flex items-center gap-1.5 px-3 h-10 rounded-full transition-all ${
                        showFilters || hasActiveFilters
                          ? "bg-matepeak-primary text-white"
                          : "bg-gray-100 text-gray-700 hover:bg-gray-200"
                      }`}
                    >
                      <SlidersHorizontal className="w-4 h-4" />
                      <span className="text-sm font-medium hidden sm:inline">
                        Filters
                      </span>
                      {hasActiveFilters && (
                        <Badge
                          variant="secondary"
                          className="h-5 w-5 p-0 flex items-center justify-center text-xs bg-white text-matepeak-primary"
                        >
                          {
                            [
                              selectedCategory !== "all",
                              priceRange !== "all",
                              experienceLevel !== "all",
                            ].filter(Boolean).length
                          }
                        </Badge>
                      )}
                    </button>

                    {/* Search Button */}
                    <button
                      type="submit"
                      className="w-10 h-10 rounded-full bg-black flex items-center justify-center hover:bg-gray-800 transition-all shadow-sm"
                    >
                      <Search className="w-4 h-4 text-white" />
                    </button>
                  </div>
                </div>

                {/* Filters Dropdown */}
                {showFilters && (
                  <div className="absolute top-full mt-2 w-full bg-white rounded-2xl shadow-xl border border-gray-100 p-5 z-50 animate-in fade-in slide-in-from-top-2 duration-200">
                    <div className="flex items-center justify-between mb-4">
                      <h3 className="text-sm font-semibold text-gray-900">
                        Refine Your Search
                      </h3>
                      {hasActiveFilters && (
                        <button
                          type="button"
                          onClick={handleClearFilters}
                          className="text-xs text-matepeak-primary hover:text-matepeak-secondary font-medium flex items-center gap-1"
                        >
                          <X className="w-3 h-3" />
                          Clear all
                        </button>
                      )}
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                      {/* Category Filter */}
                      <div className="space-y-2">
                        <label className="text-xs font-medium text-gray-600">
                          Category
                        </label>
                        <Select
                          value={selectedCategory}
                          onValueChange={setSelectedCategory}
                        >
                          <SelectTrigger className="h-10">
                            <SelectValue placeholder="All Categories" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="all">All Categories</SelectItem>
                            <SelectItem value="career">
                              Career Growth
                            </SelectItem>
                            <SelectItem value="technical">
                              Technical Skills
                            </SelectItem>
                            <SelectItem value="interview">
                              Interview Prep
                            </SelectItem>
                            <SelectItem value="mental-health">
                              Mental Health
                            </SelectItem>
                            <SelectItem value="academic">Academic</SelectItem>
                            <SelectItem value="life-coaching">
                              Life Coaching
                            </SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {/* Price Range Filter */}
                      <div className="space-y-2">
                        <label className="text-xs font-medium text-gray-600">
                          Price Range
                        </label>
                        <Select
                          value={priceRange}
                          onValueChange={setPriceRange}
                        >
                          <SelectTrigger className="h-10">
                            <SelectValue placeholder="Any Price" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="all">Any Price</SelectItem>
                            <SelectItem value="0-500">₹0 - ₹500</SelectItem>
                            <SelectItem value="500-1000">
                              ₹500 - ₹1000
                            </SelectItem>
                            <SelectItem value="1000-2000">
                              ₹1000 - ₹2000
                            </SelectItem>
                            <SelectItem value="2000+">₹2000+</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>

                      {/* Experience Level Filter */}
                      <div className="space-y-2">
                        <label className="text-xs font-medium text-gray-600">
                          Experience Level
                        </label>
                        <Select
                          value={experienceLevel}
                          onValueChange={setExperienceLevel}
                        >
                          <SelectTrigger className="h-10">
                            <SelectValue placeholder="Any Level" />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="all">Any Level</SelectItem>
                            <SelectItem value="beginner">
                              Beginner Friendly
                            </SelectItem>
                            <SelectItem value="intermediate">
                              Intermediate
                            </SelectItem>
                            <SelectItem value="advanced">Advanced</SelectItem>
                            <SelectItem value="expert">Expert</SelectItem>
                          </SelectContent>
                        </Select>
                      </div>
                    </div>

                    {/* Apply Filters Button */}
                    <div className="mt-4 pt-4 border-t border-gray-100">
                      <Button
                        type="submit"
                        onClick={() => setShowFilters(false)}
                        className="w-full bg-matepeak-primary hover:bg-matepeak-secondary h-10"
                      >
                        Apply Filters
                      </Button>
                    </div>
                  </div>
                )}

                {/* Search Dropdown */}
                {showSearchDropdown &&
                  !showFilters &&
                  searchQuery.length > 0 && (
                    <div className="absolute top-full mt-2 w-full bg-white rounded-xl shadow-lg border border-gray-100 py-2 z-50">
                      {searchSuggestions
                        .filter((s) =>
                          s.toLowerCase().includes(searchQuery.toLowerCase())
                        )
                        .slice(0, 5)
                        .map((suggestion, index) => (
                          <button
                            key={index}
                            type="button"
                            onClick={() => {
                              setSearchQuery(suggestion);
                              setShowSearchDropdown(false);
                              navigate(
                                `/explore?q=${encodeURIComponent(suggestion)}`
                              );
                            }}
                            className="w-full px-4 py-2.5 text-left hover:bg-gray-50 transition-colors flex items-center gap-3 font-poppins"
                          >
                            <Search className="w-4 h-4 text-gray-400" />
                            <span className="text-sm text-gray-700">
                              {suggestion}
                            </span>
                          </button>
                        ))}
                    </div>
                  )}
              </form>

              {/* Popular Tags */}
              <div className="flex items-center gap-2.5 flex-wrap max-w-lg">
                <span className="text-sm font-bold text-gray-900 font-poppins">
                  Try:
                </span>
                {popularOptions.map((option) => (
                  <button
                    key={option}
                    onClick={() => handlePopularClick(option)}
                    className="text-sm px-3.5 py-1 rounded-full bg-white border border-gray-200 text-gray-700 hover:border-matepeak-primary hover:text-matepeak-primary transition-all font-poppins"
                  >
                    {option}
                  </button>
                ))}
              </div>
            </div>
          </div>
          <div className="hidden lg:block overflow-hidden pt-0 relative -mt-16">
            {/* Left fade gradient */}
            <div className="absolute left-0 top-0 bottom-0 w-20 bg-gradient-to-r from-white to-transparent z-10 pointer-events-none"></div>
            {/* Right fade gradient */}
            <div className="absolute right-0 top-0 bottom-0 w-20 bg-gradient-to-l from-white to-transparent z-10 pointer-events-none"></div>

            <div className="flex gap-6 animate-scroll-left hover:pause pt-12">
              {/* First set of cards */}
              {mentorCards.map((mentor) => (
                <div key={mentor.id} className="flex-shrink-0">
                  <div
                    className="bg-white rounded-2xl border border-gray-200/60 hover:border-gray-300 p-6 pt-16 w-64 h-64 relative transition-all duration-300 group hover:-translate-y-1"
                    style={{ boxShadow: "0 10px 30px -5px rgba(0, 0, 0, 0.1)" }}
                  >
                    <div className="flex flex-col items-center">
                      <div className="w-20 h-20 rounded-full overflow-hidden mb-4 ring-2 ring-white shadow-md absolute -top-10 left-1/2 -translate-x-1/2 transition-all duration-300 group-hover:shadow-lg">
                        <img
                          src={mentor.image}
                          alt={mentor.name}
                          className="w-full h-full object-cover"
                        />
                      </div>
                      <h3 className="text-lg font-semibold text-gray-900 mb-1 font-poppins">
                        {mentor.name}
                      </h3>
                      <p className="text-gray-500 text-sm mb-4 font-poppins">
                        {mentor.title}
                      </p>
                      <div className="w-full border-t border-gray-100 pt-3 mt-auto">
                        <div className="flex items-center justify-center">
                          <span className="text-sm font-medium text-gray-700 font-poppins">
                            {mentor.company}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
              {/* Duplicate set for seamless loop */}
              {mentorCards.map((mentor) => (
                <div key={`${mentor.id}-duplicate`} className="flex-shrink-0">
                  <div
                    className="bg-white rounded-2xl border border-gray-200/60 hover:border-gray-300 p-6 pt-16 w-64 h-64 relative transition-all duration-300 group hover:-translate-y-1"
                    style={{ boxShadow: "0 10px 30px -5px rgba(0, 0, 0, 0.1)" }}
                  >
                    <div className="flex flex-col items-center">
                      <div className="w-20 h-20 rounded-full overflow-hidden mb-4 ring-2 ring-white shadow-md absolute -top-10 left-1/2 -translate-x-1/2 transition-all duration-300 group-hover:shadow-lg">
                        <img
                          src={mentor.image}
                          alt={mentor.name}
                          className="w-full h-full object-cover"
                        />
                      </div>
                      <h3 className="text-lg font-semibold text-gray-900 mb-1 font-poppins">
                        {mentor.name}
                      </h3>
                      <p className="text-gray-500 text-sm mb-4 font-poppins">
                        {mentor.title}
                      </p>
                      <div className="w-full border-t border-gray-100 pt-3 mt-auto">
                        <div className="flex items-center justify-center">
                          <span className="text-sm font-medium text-gray-700 font-poppins">
                            {mentor.company}
                          </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>

            {/* Expert Profiles Section - Below Moving Cards */}
            <div className="mt-8 text-center">
              <p className="text-gray-600 text-sm font-poppins mb-6">
                Our experts are ready to help
              </p>
              <div className="flex items-center justify-center gap-3">
                {expertProfiles.map((expert, index) => (
                  <div
                    key={expert.id}
                    className="relative"
                    style={{
                      marginLeft: index > 0 ? "-18px" : "0",
                      zIndex: expertProfiles.length - index,
                    }}
                  >
                    <div className="w-10 h-10 rounded-full overflow-hidden ring-2 ring-white shadow-sm hover:scale-110 transition-transform duration-200">
                      <img
                        src={expert.image}
                        alt={expert.name}
                        className="w-full h-full object-cover"
                        title={expert.name}
                      />
                    </div>
                  </div>
                ))}
                <div className="ml-2 text-sm font-medium text-gray-700 font-poppins">
                  and many more..
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  );
};

export default Hero;
